function processFeed(){return function(feed){var rendered,chkdt,chkdt1,newsclass,n,markup="";if(!feed.items)return $(document).trigger("countersUpdate",[0]),void 0;n=feed.items.length,n=15>n?n:15,$(document).trigger("countersUpdate",[n]),rendered=0,chkdt=chkdt1=(new Date).getTime(),chkdt-=864e5,chkdt1-=1728e5;for(var i=0;i<feed.items.length&&20>i;i++){var tstamp,dt,item=feed.items[i],itemDt=new Date(item.updated);isValidDate(itemDt)?(dt=$.format.date(itemDt,"dd/M/yyyy"),tstamp=itemDt.getTime()):(dt="--/--/----",itemDt=0,tstamp=0),0===rendered&&(rendered=1),newsclass="",itemDt.getTime()>chkdt?newsclass="news":itemDt.getTime()>chkdt1&&(newsclass="news1"),markup+='<li timestamp="'+tstamp+'" class="'+newsclass+'">'+'<div class="feedprov">'+feed.title+"</div>"+'<div class="itemdt">'+" "+dt+"</div> "+'<a class="itemtit" href="'+item.link+'" target="_blank">'+'<i class="icon-external-link"></i></a>'+'<a class="itemtitle" tabindex="-1" href="#">'+item.title+"</a>"+'<div class="itemdesc">'+item.description+"</div>"+"</li>"}rendered&&(jQuery("#feedContents").append(markup),$("#feedContents li[timestamp]").sortElements(function(a,b){return $(b).attr("timestamp")>$(a).attr("timestamp")?1:-1}))}}var isValidDate=function(d){return"[object Date]"!==Object.prototype.toString.call(d)?!1:!isNaN(d.getTime())};jQuery.fn.sortElements=function(){var sort=[].sort;return function(comparator,getSortable){getSortable=getSortable||function(){return this};var placements=this.map(function(){var sortElement=getSortable.call(this),parentNode=sortElement.parentNode,nextSibling=parentNode.insertBefore(document.createTextNode(""),sortElement.nextSibling);return function(){if(parentNode===this)throw new Error("You can't sort elements if any one is a descendant of another.");parentNode.insertBefore(this,nextSibling),parentNode.removeChild(nextSibling)}});return sort.call(this,comparator).each(function(i){placements[i].call(getSortable.call(this))})}}(),$(window).load(function(){var xmldef,lkcnt=0,feedcnt=0,selFeedsCnt=0;$(document).on("countersUpdate",function(event,links){lkcnt+=links,$("#lkcnt").text(lkcnt),feedcnt++,$("#feedcnt").text(feedcnt),$("#selFeedsCnt").text(selFeedsCnt)}),$("#subjects").on("click","li",function(){var seltxt=$(this).text();$("#refresh").text(seltxt),$(document).trigger("refresh",seltxt)}),$(document).on("refresh",function(event,subj){console.log("WILL FETCH SUBJECT "+subj),xmldef.done(function(xml){lkcnt=0,feedcnt=0,selFeedsCnt=0,console.log("FETCHING FEEDS OF SUBJECT "+subj),jQuery("#feedContents").html(""),$(xml).find("outline").not("[xmlUrl]").each(function(){var subject=$(this);if(subject.attr("title")===subj){var selFeeds=subject.find("outline[xmlUrl]");selFeedsCnt=selFeeds.length,selFeeds.each(function(){feedurl=$(this).attr("xmlUrl");var siteurl=$(this).attr("htmlUrl"),proxyurl="/rdfeed?url="+encodeURIComponent(feedurl);jQuery.getFeed({url:proxyurl,success:processFeed(feedurl,siteurl,subject)})})}})})});var reload=function(){var feedListurl="/rdfeed?cmd=rawfeeds&bmarks=subscriptions.xml";console.log("WILL GET "+feedListurl),xmldef=$.ajax({type:"GET",url:feedListurl,dataType:"xml"}).retry({times:3,timeout:1e4}),xmldef.done(function(xmldata){$("#subjects li").remove(),$(xmldata).find("outline").not("[xmlUrl]").each(function(){var subject=$(this),subjtit=subject.attr("title");console.log("SUBJECT "+subjtit);var h='<li><a class="subj" tabindex="-1">'+subjtit+"</a></li>";$("#subjects").append(h)})})};$(document).on("click","#reload",function(){reload()})}),$(window).on("load",function(){console.log("STARTING RELOAD FUNCTION BY TRIGGER"),$("#reload").trigger("click")}),key("n",function(){0==$(":focus").prev(".itemdt").length?$(".itemtit:first").focus():$(":focus").parent().next().children("a.itemtit").focus()}),key("p",function(){0==$(":focus").prev(".itemdt").length?$(".itemtit:last").focus():$(":focus").parent().prev().children("a.itemtit").focus()});var open_in_new_tab=function(url){window.open(url,"_blank"),window.focus()};key("v",function(){$(":focus").prev(".itemdt").length&&open_in_new_tab($(":focus").attr("href"))}),$(document).on("click",".itemtitle",function(ev){var dsc,p=$(ev.target).parent(),show=1;return p.children("a.itemtit").focus(),dsc=p.children(".itemdesc"),dsc.filter(":visible").length&&(show=0),$(".itemdesc").removeClass("selected"),show&&dsc.addClass("selected"),!1});